@model AppAfpaBrive.BOL.PeeDocument
@using AppAfpaBrive.BOL;
@{ 
    List<Pee> pees = new List<Pee>();
    pees = ViewBag.Pee;
    var ListPeeItem = pees.Select(p => new SelectListItem() { Text = p.MatriculeBeneficiaireNavigation.NomBeneficiaire + "  " + p.MatriculeBeneficiaireNavigation.PrenomBeneficiaire, Value = p.IdPee.ToString() }).ToList();
    var listSuivi = pees.Select(p => p.PeriodePeeSuivis).ToList();
    var lists = listSuivi.Select(s => new SelectListItem() { Text = s.Select(s => s.ObjetSuivi).FirstOrDefault(), Value = s.Select(s => s.IdPeriodePeeSuivi).FirstOrDefault().ToString() }).ToList();

}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>View</title>
</head>
<body>

    <h4>PeeDocument</h4>
    <hr />
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <form asp-action="ConsultationSuivi">
                @*<div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="IdPeeDocument" />*@
                <div class="form-group col-sm-12 col-md-8 col-lg-8">
                    @if (ListPeeItem != null)
                    {
                        @Html.DropDownListFor(p => p.IdPee, ListPeeItem, "...............Seléctionnez le Stagiaire............", new { @class = "form-control" })
                    }
                </div>
                <div class="form-group col-sm-12 col-md-8 col-lg-8">
                    @if (ViewBag.Pee != null)
                    {
                        @Html.DropDownListFor(m => m.IdPeriodePeeSuivi, new SelectList(""), ".....Seléctionnez l'objet du suivi........", new { @class = "form-control" })
                    }
                </div>
                <div class="textArea form-group col-sm-12 col-md-8 col-lg-8">

                </div>
            </form>
            <div class="form-group col-sm-12 col-md-8 col-lg-8">
                <a id="DownLoadDoc" class="btn btn-primary btn-block " href="">Télécharger le document</a>
            </div>
        </div>
    </div>


    <div>
        <a asp-action="Index">Back to List</a>
    </div>

</body>

</html>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#IdPee").change(function () {
                var peeId = $(this).val();
                var listObjectSuivi = $("#IdPeriodePeeSuivi");
                listObjectSuivi.empty();

                listObjectSuivi.append('<option selected="true" disabled>..........Seléctionnez l\'objet du suivi..........</option>');
                listObjectSuivi.prop('selectedIndex', 0);
                $.getJSON("/Pee/GetListObject?IdPee=" + peeId, function (data) {
                    $(data).each(function (index, valeur) {
                       
                        listObjectSuivi.append("<option value='" + data[index].value + "' >" + data[index].text + "</option>");
                    });

                });


            });
            $("#IdPeriodePeeSuivi").change(function () {
                var IdPeriodePeeSuivi = $(this).val();
                var BtnDownLoad = $("#DownLoadDoc");
                BtnDownLoad.attr("href", "/Pee/DownLoadDocument?IdPeeDoc=" + IdPeriodePeeSuivi);

            });
     
            });
    </script>
    

    
}
